@model EHRLite.Models.Visit

@{
    // Ana Layout'u (Menü, Footer) devre dışı bırak. Temiz baskı için
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Visit Summary - @Model.Patient.FirstName @Model.Patient.LastName</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />

    <style>
        /* CSS Başlangıcı */
        /* @@media print (Tarayıcı bu kısmı çıktı alırken kullanır) */
        @@media print {
            .no-print {
                display: none !important;
            }
            /* Baskıda butonları gizle */
            body {
                padding: 20px;
            }

            .card {
                border: none !important;
            }
            /* Kart kenarlıklarını baskıda kaldır */
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container mt-5 bg-white p-5 shadow-sm" style="max-width: 800px;">

        <div class="row border-bottom pb-3 mb-4 align-items-center">
            <div class="col-8">
                <h2 class="text-primary fw-bold mb-0">EHR Lite Hospital</h2>
                <p class="text-muted small mb-0">Electronic Health Record System</p>
            </div>
            <div class="col-4 text-end">
                <h5 class="mb-0">VISIT SUMMARY</h5>
                <small class="text-muted">Date: @DateTime.Now.ToString("dd.MM.yyyy")</small>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-6">
                <h5 class="text-secondary border-bottom pb-1">Patient Information</h5>
                <p class="mb-1"><strong>Full Name:</strong> @Model.Patient.FirstName @Model.Patient.LastName</p>
                <p class="mb-1"><strong>ID / Record:</strong> @Model.Patient.Id</p>
                <p class="mb-1"><strong>Date of Birth:</strong> @Model.Patient.DateOfBirth.ToShortDateString()</p>
                <p class="mb-1"><strong>Phone:</strong> @Model.Patient.PhoneNumber</p>
            </div>
            <div class="col-md-6">
                <h5 class="text-secondary border-bottom pb-1">Visit Details</h5>
                <p class="mb-1"><strong>Visit Date:</strong> @Model.VisitDate.ToString("dd.MM.yyyy HH:mm")</p>
                <p class="mb-1"><strong>Diagnosis:</strong> @Model.Diagnosis</p>
                <p class="mb-1"><strong>Doctor:</strong> Dr. Admin</p>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-12">
                <h5 class="text-secondary border-bottom pb-1">Clinical Notes</h5>
                <div class="p-3 bg-light rounded border">
                    @Html.Raw(Model.DoctorNotes)
                </div>
            </div>
        </div>

        @if (Model.LabResults != null && Model.LabResults.Count > 0)
        {
            <div class="row mb-4">
                <div class="col-12">
                    <h5 class="text-secondary border-bottom pb-1">Laboratory Results</h5>
                    <table class="table table-sm table-bordered mt-2">
                        <thead class="table-light">
                            <tr>
                                <th>Test</th>
                                <th>Result</th>
                                <th>Unit</th>
                                <th>Reference</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var lab in Model.LabResults)
                            {
                                // Risk kontrolü (Referans aralığı dışındaysa isRisky=true olur)
                                bool isRisky = false;
                                if (lab.MinReference != null && lab.Value < lab.MinReference) { isRisky = true; }
                                if (lab.MaxReference != null && lab.Value > lab.MaxReference) { isRisky = true; }

                                <tr>
                                    <td>@lab.TestName</td>
                                    <td class="@(isRisky ? "fw-bold text-danger" : "")">@lab.Value</td>
                                    <td>@lab.Unit</td>
                                    <td>@lab.MinReference - @lab.MaxReference</td>
                                    <td>
                                        @if (isRisky)
                                        {
                                            <span class="text-danger fw-bold">ABNORMAL</span>
                                        }
                                        else
                                        {
                                            <span class="text-success">Normal</span>
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        }

        <div class="row mt-5 pt-4 border-top">
            <div class="col-6">
                <p class="small text-muted">This document was generated electronically.</p>
            </div>
            <div class="col-6 text-end">
                <p class="mb-5">Signature / Stamp</p>
                <p>_______________________</p>
            </div>
        </div>

        <div class="text-center mt-4 no-print">
            <button onclick="window.print()" class="btn btn-lg btn-primary">
                <i class="fa-solid fa-print"></i> Print / Save as PDF
            </button>
            <button onclick="window.history.back()" class="btn btn-lg btn-secondary ms-2">Back</button>
        </div>

    </div>
</body>
</html>